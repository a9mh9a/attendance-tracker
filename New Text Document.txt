<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Attendance & Overtime Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAWlBMVEUAAAD///////////////////////////////////////////////////////////8gJSjZAAAAHnRSTlMAgECQwCCQYCDw8JAgQJBwQGCgQPDQ0JBQYDCgUGCrCbbpAAAAmElEQVQ4y2NggAIGBkYGFhZWNnYOBkZObh5ePn4BQSFhEVExcQlJKQZJaRlZOXkFRSUVVTU1dQ1NBi1tHV09fQNDI2MTUzNzC0srBmsbWzt7B0cnZxdXN3cPTwYvbx9fP/+AwKDgkNCw8AhGhsiocEDh6JjYuPgERgYgSEpOSU1Lz8jMys5hYGjty88vKCwqLiktYwAAnIsW+WlW9q0AAAAASUVORK5CYII=">
<style>
:root {
  --primary-color: #007BFF;
  --secondary-color: #0056b3;
  --success-color: #28a745;
  --danger-color: #dc3545;
  --warning-color: #ffc107;
  --info-color: #17a2b8;
  --text-color: #000;
  --bg-color: #f4f6f9;
  --card-bg: rgba(255, 255, 255, 0.9);
  --border-color: #ddd;
  --shadow: 0 2px 10px rgba(0,0,0,0.1);
}
body.dark {
  --bg-color: #121212;
  --card-bg: rgba(30, 30, 30, 0.9);
  --text-color: #eee;
  --border-color: #444;
  --shadow: 0 2px 10px rgba(0,0,0,0.3);
}

* {
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
  margin: 0; 
  padding: 20px;
  transition: all 0.3s ease;
  line-height: 1.6;
  position: relative;
  min-height: 100vh;
  padding-bottom: 60px; /* مساحة للتذييل */
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 15px;
}

h1, h2, h3 {
  text-align: center;
  margin-top: 0;
  color: var(--primary-color);
}

.card {
  background: var(--card-bg);
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: var(--shadow);
  border: 1px solid var(--border-color);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
  background: var(--card-bg);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: var(--shadow);
}

th, td {
  border: 1px solid var(--border-color);
  padding: 12px;
  text-align: center;
}

th {
  background: var(--primary-color);
  color: white;
  font-weight: 600;
}

.workday { 
  background: rgba(40, 167, 69, 0.15); 
  color: #155724; 
  font-weight: bold;
}

.holiday { 
  background: rgba(220, 53, 69, 0.15); 
  color: #721c24; 
  font-weight: bold;
}

.btn {
  display: inline-block;
  padding: 10px 20px;
  margin: 10px 5px;
  background: var(--primary-color);
  border: none;
  color: white;
  border-radius: 5px;
  cursor: pointer;
  text-align: center;
  font-size: 16px;
  transition: all 0.3s;
  text-decoration: none;
}

.btn:hover {
  background: var(--secondary-color);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.btn-success {
  background: var(--success-color);
}

.btn-success:hover {
  background: #218838;
}

.btn-danger {
  background: var(--danger-color);
}

.btn-danger:hover {
  background: #c82333;
}

.btn-warning {
  background: var(--warning-color);
  color: #212529;
}

.btn-warning:hover {
  background: #e0a800;
}

.btn-info {
  background: var(--info-color);
}

.btn-info:hover {
  background: #138496;
}

.form-group {
  margin-bottom: 15px;
}

label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

input, select {
  width: 100%;
  padding: 10px;
  border: 1px solid var(--border-color);
  border-radius: 5px;
  background: var(--card-bg);
  color: var(--text-color);
  font-size: 16px;
}

input:focus, select:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
}

#greeting {
  text-align: center;
  margin: 20px 0;
  font-size: 1.5em;
  font-weight: bold;
  color: var(--primary-color);
  padding: 10px;
  background: var(--card-bg);
  border-radius: 8px;
  box-shadow: var(--shadow);
}

.hidden {
  display: none !important;
}

.visible {
  display: block !important;
}

.flex {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
}

/* قائمة جانبية */
#sidebar {
  position: fixed;
  top: 0;
  left: -250px;
  width: 250px;
  height: 100%;
  background: var(--card-bg);
  box-shadow: 2px 0 10px rgba(0,0,0,0.2);
  transition: left 0.3s ease;
  padding: 60px 20px 20px;
  z-index: 1000;
  overflow-y: auto;
}

#sidebar .btn {
  width: 100%;
  margin-bottom: 10px;
  background: transparent;
  color: var(--text-color);
  border: 1px solid var(--border-color);
}

#sidebar .btn:hover {
  background: var(--primary-color);
  color: white;
}

#sidebarToggle {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1100;
  cursor: pointer;
  font-size: 24px;
  background: transparent;
  color: var(--text-color);
  border: 1px solid var(--border-color);
  padding: 10px 15px;
  border-radius: 5px;
  transition: all 0.3s;
}

#themeToggle {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1100;
  cursor: pointer;
  font-size: 24px;
  background: transparent;
  color: var(--text-color);
  border: 1px solid var(--border-color);
  padding: 10px 15px;
  border-radius: 50%;
  transition: all 0.3s;
}

.sidebar-open #sidebar {
  left: 0;
}

/* تذييل الصفحة */
footer {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  text-align: center;
  padding: 15px;
  background: var(--card-bg);
  color: var(--text-color);
  border-top: 1px solid var(--border-color);
  font-size: 14px;
}

/* متجاوب للموبايل */
@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  h1 {
    font-size: 1.5em;
    margin-top: 40px;
  }
  
  h2 {
    font-size: 1.3em;
  }
  
  table {
    font-size: 14px;
  }
  
  th, td {
    padding: 8px 5px;
  }
  
  .btn {
    padding: 8px 15px;
    font-size: 14px;
  }
  
  #sidebar {
    width: 200px;
    left: -200px;
  }
  
  footer {
    position: relative;
    margin-top: 20px;
  }
  
  body {
    padding-bottom: 20px;
  }
}

@media (max-width: 480px) {
  h1 {
    font-size: 1.3em;
  }
  
  th, td {
    padding: 6px 3px;
    font-size: 12px;
  }
  
  .btn {
    padding: 6px 10px;
    font-size: 12px;
  }
  
  input, select {
    padding: 8px;
    font-size: 14px;
  }
}

/* تحسينات للجدول */
.table-container {
  overflow-x: auto;
  margin: 20px 0;
  border-radius: 8px;
  box-shadow: var(--shadow);
}

/* تحسينات للنماذج */
.form-card {
  max-width: 500px;
  margin: 20px auto;
}

/* أنيميشن للأزرار */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.pulse {
  animation: pulse 1.5s infinite;
}

/* تحسينات للشيك بوكس */
input[type="checkbox"] {
  width: 20px;
  height: 20px;
  accent-color: var(--primary-color);
}

/* تحسينات للتاريخ */
.date-display {
  font-weight: bold;
  color: var(--primary-color);
}

/* تحسينات للوقت الإضافي */
.ot-item {
  display: flex;
  flex-direction: column;
  padding: 10px;
  border-bottom: 1px solid var(--border-color);
  margin-bottom: 10px;
  text-align: center;
}

.ot-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
}

.ot-date {
  font-weight: bold;
  margin-bottom: 5px;
}

.ot-hours {
  background: var(--primary-color);
  color: white;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 16px;
  margin: 5px 0;
  display: inline-block;
}

.ot-actions {
  display: flex;
  justify-content: center;
  gap: 5px;
  margin-top: 10px;
}

/* تحسينات لرسائل التنبيه */
.alert {
  padding: 15px;
  border-radius: 5px;
  margin: 15px 0;
  text-align: center;
}

.alert-success {
  background: rgba(40, 167, 69, 0.2);
  color: #155724;
  border: 1px solid #c3e6cb;
}

.alert-danger {
  background: rgba(220, 53, 69, 0.2);
  color: #721c24;
  border: 1px solid #f5c6cb;
}

/* تحسينات للشريط الجانبي */
.sidebar-header {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  padding: 15px;
  background: var(--card-bg);
  color: var(--text-color);
  text-align: center;
  font-weight: bold;
  border-bottom: 1px solid var(--border-color);
}

/* تحسينات للوضع الداكن */
body.dark .btn {
  box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}

body.dark input, 
body.dark select {
  border-color: #555;
}

/* نمط زر التعديل والحذف */
.btn-edit {
  background: var(--warning-color);
  color: #212529;
  padding: 5px 10px;
  font-size: 14px;
}

.btn-delete {
  background: var(--danger-color);
  padding: 5px 10px;
  font-size: 14px;
}

/* نمط نموذج التعديل */
.edit-form {
  display: none;
  margin-top: 10px;
  padding: 10px;
  background: var(--card-bg);
  border-radius: 5px;
  border: 1px solid var(--border-color);
}

/* تحسينات للأزرار الشفافة */
.transparent-btn {
  background: transparent !important;
  color: var(--text-color) !important;
  border: 1px solid var(--border-color) !important;
}

.transparent-btn:hover {
  background: var(--primary-color) !important;
  color: white !important;
}

/* إضافة نمط لزر إغلاق القائمة */
#sidebarToggle.close {
  background: var(--danger-color);
  color: white;
}
</style>
</head>
<body>

<div class="container">
  <h1>📅 متتبع الحضور والوقت الإضافي</h1>

  <div id="loginForm" class="card form-card">
    <h2>تسجيل حساب جديد</h2>
    <div class="form-group">
      <label for="username">الاسم:</label>
      <input type="text" id="username" placeholder="أدخل اسمك">
    </div>
    <div class="form-group">
      <label for="role">الدور:</label>
      <select id="role">
        <option value="مهندس">مهندس</option>
        <option value="فني">فني</option>
      </select>
    </div>
    <div class="form-group">
      <label for="firstWorkDay">أول يوم دوام:</label>
      <input type="date" id="firstWorkDay">
    </div>
    <button id="registerBtn" class="btn btn-success">تسجيل</button>
  </div>

  <div id="greeting" class="hidden"></div>

  <div id="mainContent" class="hidden">
    <!-- جدول الحضور -->
    <div class="card">
      <h2>جدول الحضور</h2>
      <div class="table-container">
        <table id="attendanceTable">
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>اليوم</th>
              <th>الحالة</th>
              <th>✔️ حضور</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- فورم الوقت الإضافي -->
    <div id="overtimeForm" class="card form-card hidden">
      <h2>إضافة وقت إضافي</h2>
      <div class="form-group">
        <label for="otDate">التاريخ:</label>
        <input type="date" id="otDate">
      </div>
      <div class="form-group">
        <label for="otHours">الساعات:</label>
        <input type="number" id="otHours" min="1" placeholder="عدد الساعات">
      </div>
      <button id="saveOTBtn" class="btn">حفظ</button>
    </div>

    <!-- قائمة الوقت الإضافي -->
    <div id="overtimeList" class="card hidden">
      <h2>🕒 قائمة الوقت الإضافي</h2>
      <div id="overtimeItems"></div>
    </div>
  </div>
</div>

<!-- القائمة الجانبية -->
<button id="sidebarToggle" class="hidden">☰</button>
<div id="sidebar">
  <div class="sidebar-header">القائمة</div>
  <button id="overtimeSidebarBtn" class="btn transparent-btn">➕ إضافة وقت إضافي</button>
  <button id="reportSidebarBtn" class="btn transparent-btn">📊 إنشاء تقرير</button>
  <button id="resetSidebarBtn" class="btn transparent-btn">🔄 إعادة تسجيل الدخول</button>
</div>

<!-- زر الثيم -->
<button id="themeToggle" class="transparent-btn">🌞</button>

<!-- تذييل الصفحة -->
<footer>
  منشئ البرنامج : المهندس حسين محمد &copy; 2023 - جميع الحقوق محفوظة
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const attendanceKey = "attendanceData";
  const overtimeKey = "overtimeData";
  const userKey = "userData";

  let attendanceData = JSON.parse(localStorage.getItem(attendanceKey)) || {};
  let overtimeData = JSON.parse(localStorage.getItem(overtimeKey)) || [];
  let userData = JSON.parse(localStorage.getItem(userKey));

  const loginForm = document.getElementById("loginForm");
  const greetingDiv = document.getElementById("greeting");
  const mainContent = document.getElementById("mainContent");
  const attendanceTable = document.getElementById("attendanceTable");
  const overtimeList = document.getElementById("overtimeList");
  const overtimeItems = document.getElementById("overtimeItems");
  const overtimeForm = document.getElementById("overtimeForm");
  const saveOTBtn = document.getElementById("saveOTBtn");

  const sidebar = document.getElementById("sidebar");
  const sidebarToggle = document.getElementById("sidebarToggle");
  const overtimeSidebarBtn = document.getElementById("overtimeSidebarBtn");
  const reportSidebarBtn = document.getElementById("reportSidebarBtn");
  const resetSidebarBtn = document.getElementById("resetSidebarBtn");
  const themeToggle = document.getElementById("themeToggle");

  // تحميل الوضع الداكن إذا كان مفعلًا سابقًا
  if (localStorage.getItem("darkMode") === "enabled") {
    document.body.classList.add("dark");
    themeToggle.textContent = "🌙";
  }

  function showGreeting() {
    const now = new Date();
    const hour = now.getHours();
    let greeting = hour < 12 ? "صباح الخير" : "مساء الخير";
    greetingDiv.textContent = `${greeting} ${userData.role} ${userData.name}`;
    greetingDiv.classList.remove("hidden");
  }

  function getDayName(date) {
    const days = ["الأحد", "الاثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة", "السبت"];
    return days[date.getDay()];
  }

  function generateSchedule() {
    const tbody = document.querySelector("#attendanceTable tbody");
    tbody.innerHTML = "";
    
    if (!userData || !userData.firstWorkDay) return;
    
    let startDate = new Date(userData.firstWorkDay);
    let currentDate = new Date(startDate);
    
    // حساب نهاية الشهر الحالي
    const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
    
    // إنشاء جدول من تاريخ البدء حتى نهاية الشهر
    let dayCounter = 0;
    let isWorkDay = true; // أول يوم دوام هو يوم عمل
    
    while (currentDate <= endOfMonth) {
      const dateStr = currentDate.toISOString().split("T")[0];
      const status = isWorkDay ? "Workday" : "Holiday";
      
      const row = document.createElement("tr");
      row.innerHTML = `
        <td class="date-display">${dateStr}</td>
        <td>${getDayName(currentDate)}</td>
        <td class="${isWorkDay ? 'workday' : 'holiday'}">${status}</td>
        <td>${isWorkDay ? 
          `<input type="checkbox" data-date="${dateStr}" ${attendanceData[dateStr] ? 'checked' : ''}>` : 
          "❌"}</td>
      `;
      
      tbody.appendChild(row);

      const cb = row.querySelector("input[type='checkbox']");
      if (cb) {
        cb.addEventListener("change", () => {
          attendanceData[cb.dataset.date] = cb.checked;
          localStorage.setItem(attendanceKey, JSON.stringify(attendanceData));
        });
      }
      
      // تحديث حالة اليوم التالي (يوم دوام يتبعه يومان عطلة)
      if (isWorkDay) {
        isWorkDay = false; // اليوم التالي عطلة
      } else {
        // إذا كان اليوم عطلة، نتحقق إذا كانت العطلة الثانية
        if (dayCounter % 3 === 2) {
          isWorkDay = true; // نعود إلى يوم دوام
        }
      }
      
      dayCounter++;
      currentDate.setDate(currentDate.getDate() + 1);
    }
    
    renderOvertime();
  }

  // إصلاح: جعل الدالة محلية بدلاً من global
  function scrollToOvertime() {
    overtimeForm.classList.remove("hidden");
    overtimeForm.scrollIntoView({ behavior: "smooth" });
  }

  function saveOvertime() {
    const date = document.getElementById("otDate").value;
    const hours = document.getElementById("otHours").value;
    
    if (!date || !hours) {
      showAlert("يرجى إكمال جميع البيانات", "danger");
      return;
    }
    
    overtimeData.push({ date, hours });
    localStorage.setItem(overtimeKey, JSON.stringify(overtimeData));
    
    document.getElementById("otDate").value = "";
    document.getElementById("otHours").value = "";
    
    renderOvertime();
    overtimeForm.classList.add("hidden");
    
    showAlert("تم حفظ الوقت الإضافي بنجاح", "success");
  }

  // إصلاح: جعل الدالة محلية بدلاً من global
  function editOvertime(index) {
    const item = overtimeData[index];
    const editForm = document.getElementById(`editForm-${index}`);
    
    if (editForm.style.display === "block") {
      editForm.style.display = "none";
      return;
    }
    
    // إخفاء جميع نماذج التعديل الأخرى
    document.querySelectorAll('.edit-form').forEach(form => {
      form.style.display = "none";
    });
    
    editForm.innerHTML = `
      <div class="form-group">
        <label for="editDate-${index}">التاريخ:</label>
        <input type="date" id="editDate-${index}" value="${item.date}">
      </div>
      <div class="form-group">
        <label for="editHours-${index}">الساعات:</label>
        <input type="number" id="editHours-${index}" value="${item.hours}" min="1">
      </div>
      <button class="btn btn-success" onclick="saveEdit(${index})">حفظ التعديل</button>
      <button class="btn btn-danger" onclick="cancelEdit(${index})">إلغاء</button>
    `;
    
    editForm.style.display = "block";
  }

  // إصلاح: جعل الدوال global بشكل صحيح
  window.saveEdit = function(index) {
    const date = document.getElementById(`editDate-${index}`).value;
    const hours = document.getElementById(`editHours-${index}`).value;
    
    if (!date || !hours) {
      showAlert("يرجى إكمال جميع البيانات", "danger");
      return;
    }
    
    overtimeData[index] = { date, hours };
    localStorage.setItem(overtimeKey, JSON.stringify(overtimeData));
    
    renderOvertime();
    showAlert("تم تعديل الوقت الإضافي بنجاح", "success");
  }

  window.cancelEdit = function(index) {
    document.getElementById(`editForm-${index}`).style.display = "none";
  }

  // إصلاح: جعل الدالة محلية بدلاً من global
  function deleteOvertime(index) {
    if (confirm("هل أنت متأكد من أنك تريد حذف هذا الوقت الإضافي؟")) {
      overtimeData.splice(index, 1);
      localStorage.setItem(overtimeKey, JSON.stringify(overtimeData));
      renderOvertime();
      showAlert("تم حذف الوقت الإضافي بنجاح", "success");
    }
  }

  function renderOvertime() {
    overtimeItems.innerHTML = "";
    
    if (overtimeData.length === 0) {
      overtimeList.classList.add("hidden");
      return;
    }
    
    overtimeList.classList.remove("hidden");
    
    overtimeData.forEach((item, index) => {
      const otItem = document.createElement("div");
      otItem.className = "ot-item";
      otItem.innerHTML = `
        <div class="ot-date">${item.date}</div>
        <div class="ot-hours">${item.hours} ساعة</div>
        <div class="ot-actions">
          <button class="btn btn-edit" onclick="editOvertime(${index})">✏️ تعديل</button>
          <button class="btn btn-delete" onclick="deleteOvertime(${index})">🗑️ حذف</button>
        </div>
        <div id="editForm-${index}" class="edit-form"></div>
      `;
      overtimeItems.appendChild(otItem);
    });
    
    // إصلاح: ربط الأحداث للأزرار الجديدة
    document.querySelectorAll('.btn-edit').forEach((btn, index) => {
      btn.onclick = () => editOvertime(index);
    });
    
    document.querySelectorAll('.btn-delete').forEach((btn, index) => {
      btn.onclick = () => deleteOvertime(index);
    });
  }

  function generateReport() {
    if (!userData) return;
    
    // حساب إجمالي أيام العمل والحضور والوقت الإضافي
    let totalWorkDays = 0;
    let totalAttendance = 0;
    let totalOvertime = 0;
    
    // حساب إجمالي أيام العمل
    let currentDate = new Date(userData.firstWorkDay);
    const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
    let dayCounter = 0;
    let isWorkDay = true;
    
    while (currentDate <= endOfMonth) {
      const dateStr = currentDate.toISOString().split("T")[0];
      
      if (isWorkDay) {
        totalWorkDays++;
        if (attendanceData[dateStr]) {
          totalAttendance++;
        }
      }
      
      // تحديث حالة اليوم التالي (يوم دوام يتبعه يومان عطلة)
      if (isWorkDay) {
        isWorkDay = false;
      } else {
        if (dayCounter % 3 === 2) {
          isWorkDay = true;
        }
      }
      
      dayCounter++;
      currentDate.setDate(currentDate.getDate() + 1);
    }
    
    // حساب إجمالي الوقت الإضافي
    overtimeData.forEach(item => {
      totalOvertime += parseInt(item.hours);
    });
    
    // إنشاء محتوى التقرير
    const reportContent = `
      تقرير الحضور والوقت الإضافي
      ============================
      الاسم: ${userData.name}
      الدور: ${userData.role}
      تاريخ أول يوم دوام: ${userData.firstWorkDay}
      
      إحصائيات الشهر:
      - إجمالي أيام العمل: ${totalWorkDays}
      - أيام الحضور: ${totalAttendance}
      - أيام الغياب: ${totalWorkDays - totalAttendance}
      - إجمالي الوقت الإضافي: ${totalOvertime} ساعة
      
      تفاصيل الوقت الإضافي:
      ${overtimeData.map(item => `- ${item.date}: ${item.hours} ساعة`).join('\n')}
    `;
    
    // إنشاء ملف وتنزيله
    const blob = new Blob([reportContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `تقرير_${userData.name}_${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showAlert("تم إنشاء التقرير بنجاح", "success");
  }

  function showAlert(message, type) {
    const alert = document.createElement("div");
    alert.className = `alert alert-${type}`;
    alert.textContent = message;
    
    document.querySelector(".container").insertBefore(alert, document.querySelector(".container").firstChild);
    
    setTimeout(() => {
      alert.remove();
    }, 3000);
  }

  function loginUser(name, role, firstWorkDay) {
    userData = { name, role, firstWorkDay };
    localStorage.setItem(userKey, JSON.stringify(userData));
    
    loginForm.classList.add("hidden");
    mainContent.classList.remove("hidden");
    sidebarToggle.classList.remove("hidden");
    
    showGreeting();
    generateSchedule();
  }

  // تسجيل مستخدم جديد
  document.getElementById("registerBtn").addEventListener("click", () => {
    const name = document.getElementById("username").value.trim();
    const role = document.getElementById("role").value;
    const firstWorkDay = document.getElementById("firstWorkDay").value;
    
    if (!name || !firstWorkDay) {
      showAlert("يرجى إكمال جميع البيانات", "danger");
      return;
    }
    
    loginUser(name, role, firstWorkDay);
  });

  // حفظ الوقت الإضافي
  saveOTBtn.addEventListener("click", saveOvertime);

  // إنشاء تقرير
  reportSidebarBtn.addEventListener("click", generateReport);

  // إعادة التعيين
  resetSidebarBtn.addEventListener("click", () => {
    if (confirm("هل أنت متأكد من أنك تريد إعادة التعيين؟ سيتم حذف جميع البيانات.")) {
      localStorage.removeItem(userKey);
      localStorage.removeItem(attendanceKey);
      localStorage.removeItem(overtimeKey);
      
      loginForm.classList.remove("hidden");
      mainContent.classList.add("hidden");
      greetingDiv.classList.add("hidden");
      sidebarToggle.classList.add("hidden");
      document.body.classList.remove("sidebar-open");
      sidebarToggle.textContent = "☰";
      sidebarToggle.classList.remove("close");
      
      userData = null;
      attendanceData = {};
      overtimeData = [];
      
      document.getElementById("username").value = "";
      document.getElementById("firstWorkDay").value = "";
    }
  });

  // إذا كان هناك مستخدم مسجل بالفعل
  if (userData) {
    loginForm.classList.add("hidden");
    mainContent.classList.remove("hidden");
    sidebarToggle.classList.remove("hidden");
    showGreeting();
    generateSchedule();
  }

  // القائمة الجانبية
  sidebarToggle.addEventListener("click", () => {
    document.body.classList.toggle("sidebar-open");
    
    // تغيير الأيقونة عند فتح/إغلاق القائمة
    if (document.body.classList.contains("sidebar-open")) {
      sidebarToggle.textContent = "✕";
      sidebarToggle.classList.add("close");
    } else {
      sidebarToggle.textContent = "☰";
      sidebarToggle.classList.remove("close");
    }
  });

  overtimeSidebarBtn.addEventListener("click", () => {
    scrollToOvertime();
    document.body.classList.remove("sidebar-open");
    sidebarToggle.textContent = "☰"; // إعادة الأيقونة إلى وضع القائمة
    sidebarToggle.classList.remove("close");
  });

  // إضافة حدث النقر خارج القائمة لإغلاقها
  document.addEventListener("click", (e) => {
    if (document.body.classList.contains("sidebar-open") && 
        !sidebar.contains(e.target) && 
        e.target !== sidebarToggle) {
      document.body.classList.remove("sidebar-open");
      sidebarToggle.textContent = "☰";
      sidebarToggle.classList.remove("close");
    }
  });

  // تبديل الوضع الداكن
  themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    
    if (document.body.classList.contains("dark")) {
      themeToggle.textContent = "🌙";
      localStorage.setItem("darkMode", "enabled");
    } else {
      themeToggle.textContent = "🌞";
      localStorage.setItem("darkMode", "disabled");
    }
  });

  // إصلاح: جعل الدوال global بشكل صحيح
  window.editOvertime = editOvertime;
  window.deleteOvertime = deleteOvertime;
  window.scrollToOvertime = scrollToOvertime;

});
</script>
</body>
</html>